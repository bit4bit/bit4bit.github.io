<!doctype html><html lang=es-co><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=author content="Jovany Leandro G.C"><meta name=description content="Una de las funcionalidades más prácticas o almenos más usadas por empresas en la gestión de sus usuarios es un mecanimo que conecte al usuario con un agente ante un evento, los eventos más comunes son:
el usuario solicita que lo contacten (ejemplo al diligenciar un formulario) un agente solicita contactar con otro usuario sin conocer el número destino (ejemplo gestión en un CRM). contactar a usuario ante una campaña de mercadeo."><link rel=icon href=http://bit4bit.github.io/favicon.ico><meta name=keywords content=" voip  freeswitch  Elixir  Crystal  Ruby  PHP "><meta property="og:title" content="Freeswitch Integración - event2dial"><meta property="og:description" content="Una de las funcionalidades más prácticas o almenos más usadas por empresas en la gestión de sus usuarios es un mecanimo que conecte al usuario con un agente ante un evento, los eventos más comunes son:
el usuario solicita que lo contacten (ejemplo al diligenciar un formulario) un agente solicita contactar con otro usuario sin conocer el número destino (ejemplo gestión en un CRM). contactar a usuario ante una campaña de mercadeo."><meta property="og:type" content="article"><meta property="og:url" content="http://bit4bit.github.io/post/freeswitch_integration_event2dial/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-07-01T16:15:01-05:00"><meta property="article:modified_time" content="2023-07-01T16:15:01-05:00"><link rel=canonical href=http://bit4bit.github.io/post/freeswitch_integration_event2dial/><meta itemprop=name content="Freeswitch Integración - event2dial"><meta itemprop=description content="Una de las funcionalidades más prácticas o almenos más usadas por empresas en la gestión de sus usuarios es un mecanimo que conecte al usuario con un agente ante un evento, los eventos más comunes son:
el usuario solicita que lo contacten (ejemplo al diligenciar un formulario) un agente solicita contactar con otro usuario sin conocer el número destino (ejemplo gestión en un CRM). contactar a usuario ante una campaña de mercadeo."><meta itemprop=datePublished content="2023-07-01T16:15:01-05:00"><meta itemprop=dateModified content="2023-07-01T16:15:01-05:00"><meta itemprop=wordCount content="642"><meta itemprop=keywords content><link media=screen rel=stylesheet href=http://bit4bit.github.io/css/common.css><link media=screen rel=stylesheet href=http://bit4bit.github.io/css/content.css><title>Freeswitch Integración - event2dial - Bit4bit Integraciones</title><meta name=twitter:card content="summary"><meta name=twitter:title content="Freeswitch Integración - event2dial"><meta name=twitter:description content="Una de las funcionalidades más prácticas o almenos más usadas por empresas en la gestión de sus usuarios es un mecanimo que conecte al usuario con un agente ante un evento, los eventos más comunes son:
el usuario solicita que lo contacten (ejemplo al diligenciar un formulario) un agente solicita contactar con otro usuario sin conocer el número destino (ejemplo gestión en un CRM). contactar a usuario ante una campaña de mercadeo."><link rel=stylesheet href=http://bit4bit.github.io/css/single.css></head><body><div id=wrapper><header id=header><h1><a href=http://bit4bit.github.io/>Bit4bit Integraciones</a></h1><nav><span class=nav-bar-item><a class=link href=/>Post</a></span>
<span class=nav-bar-item><a class=link href=/post/>Archives</a></span>
<span class=nav-bar-item><a class=link href=/about/>About</a></span></nav></header><main id=main class=post><h1>Freeswitch Integración - event2dial</h1><article class=content><p>Una de las funcionalidades más prácticas o almenos más usadas por empresas
en la gestión de sus usuarios es un mecanimo que conecte al usuario
con un agente ante un evento, los eventos más comunes son:</p><ul><li>el usuario solicita que lo contacten (ejemplo al diligenciar un formulario)</li><li>un agente solicita contactar con otro usuario sin conocer el número destino (ejemplo gestión en un CRM).</li><li>contactar a usuario ante una campaña de mercadeo.</li></ul><p>Para FreeSWITCH tenemos muy poca documentación de como realizar este tipo de
integraciones así que vamos a realizar una implementación de este tipo de servicio (event2dial)
desde FreeSWITCH.</p><p>Nuestro escenario sería:</p><ul><li>Como consumidor debo estar en la capacidad de solicitar que me contacten lo más antes posible.</li></ul><p>Para satisfacer el escenario anterio en un ambiente web, llegamos al acuerdo que el usuario
pueda diligenciar un formulario para ser contactado.</p><p>FreeSWITCH es un softswitch extenso el cual ofrece diferentes medios para realizar
integraciónes, donde por nombrar algunos:</p><ul><li>por medio de <strong>mod_event_socket</strong></li><li>por medio de lenguage integrados como: <strong>mod_lua</strong>, <strong>mod_python</strong>, <strong>mod_perl</strong></li><li>por medio de <strong>mod_xml_curl</strong></li><li>por medio de <strong>mod_xml_rpc</strong></li><li>por medio de <strong>mod_httapi</strong></li><li>o bien una mezcla de todo</li></ul><p>para esta implementación usaremos el modulo <strong>mod_xml_rpc</strong> el cual nos ofrece un <a href=https://en.wikipedia.org/wiki/Remote_procedure_call><strong>rpc</strong></a>
para comandar el FreeSWITCH siendo la ejecución de forma sincronica es decir al comandar esperaremos por el resultado,
para unas decenas de llamadas por minuto esto es suficiente pero para superar estos limites necesitariamos otra
estrategia diferente.</p><p>importante antes de empezar:</p><ul><li>conocer como instalar y operar un FreeSWITCH</li><li>ejecutable <strong>freeswitch 1.10.9</strong> con los modulos <strong>mod_xml_rpc</strong> y <strong>mod_sofia</strong></li></ul><p><strong>freeswitch.xml</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#999;font-weight:700>&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;document</span> <span style=color:teal>type=</span><span style=color:#b84>&#34;freeswitch/xml&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;section</span> <span style=color:teal>name=</span><span style=color:#b84>&#34;configuration&#34;</span> <span style=color:teal>description=</span><span style=color:#b84>&#34;Various Configuration&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;configuration</span> <span style=color:teal>name=</span><span style=color:#b84>&#34;modules.conf&#34;</span> <span style=color:teal>description=</span><span style=color:#b84>&#34;Modules&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;modules&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;load</span> <span style=color:teal>module=</span><span style=color:#b84>&#34;mod_console&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;load</span> <span style=color:teal>module=</span><span style=color:#b84>&#34;mod_commands&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;load</span> <span style=color:teal>module=</span><span style=color:#b84>&#34;mod_dptools&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#998;font-style:italic>&lt;!-- habilitamos el modulo de nuestro interes --&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;load</span> <span style=color:teal>module=</span><span style=color:#b84>&#34;mod_xml_rpc&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;/modules&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>&lt;!-- resto de configuración --&gt;</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>&lt;!-- configuracion minima para xml_rpc.conf OJO actualmente escucha en todas la interfaz --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;configuration</span> <span style=color:teal>name=</span><span style=color:#b84>&#34;xml_rpc.conf&#34;</span> <span style=color:teal>description=</span><span style=color:#b84>&#34;XML RPC&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;settings&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;param</span> <span style=color:teal>name=</span><span style=color:#b84>&#34;http-port&#34;</span> <span style=color:teal>value=</span><span style=color:#b84>&#34;8080&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;/settings&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/section&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;section</span> <span style=color:teal>name=</span><span style=color:#b84>&#34;dialplan&#34;</span> <span style=color:teal>description=</span><span style=color:#b84>&#34;Regex/XML Dialplan&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#998;font-style:italic>&lt;!-- cuando contactemos el usuario con el `originate` el FreeSWITCH
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>		 ejecutará el siguiente plan de marcado para controlar su flujo
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>		 áca podemos indicar acciones como:
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>		 - conectar con un usuario/extensión
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>		 - conectar con una linea de tierra o mobil
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>		 - reproducir un audio
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>		 - mover la llamada a una queue
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>		 - iniciar un IVR
</span></span></span><span style=display:flex><span><span style=color:#998;font-style:italic>	--&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;context</span> <span style=color:teal>name=</span><span style=color:#b84>&#34;event2dial&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:#998;font-style:italic>&lt;!-- acciones a realizar una vez se logro contactar al usuario --&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;extension</span> <span style=color:teal>name=</span><span style=color:#b84>&#34;event2dial&#34;</span><span style=color:navy>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;condition&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:#998;font-style:italic>&lt;!-- todas las llamadas son contestadas por el agente 1000 --&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;action</span> <span style=color:teal>application=</span><span style=color:#b84>&#34;set&#34;</span> <span style=color:teal>data=</span><span style=color:#b84>&#34;hangup_after_bridge=true&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;action</span> <span style=color:teal>application=</span><span style=color:#b84>&#34;bridge&#34;</span> <span style=color:teal>data=</span><span style=color:#b84>&#34;user/1000&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>		  <span style=color:navy>&lt;action</span> <span style=color:teal>application=</span><span style=color:#b84>&#34;hangup&#34;</span><span style=color:navy>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:navy>&lt;/condition&gt;</span>
</span></span><span style=display:flex><span>	  <span style=color:navy>&lt;/extension&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:navy>&lt;/context&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:navy>&lt;/section&gt;</span>
</span></span><span style=display:flex><span><span style=color:navy>&lt;/document&gt;</span>
</span></span></code></pre></div><p>primero confirmamos actividad del puerto, en caso de no obtener
respuesta revisar configuración de FreeSWITCH.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -sSG -XGET <span style=color:#b84>&#39;http://localhost:8080/xmlapi/uptime&#39;</span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># 2</span>
</span></span></code></pre></div><p>ahora, asumamos que tenemos configurada la pasarela <code>celulares</code> que nos
da salida a llamadas a celulares en colombia, entonces
para lanzar la llamada al numero 3001234567 seria:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>curl -sSG -XGET <span style=color:#b84>&#39;http://localhost:8080/api/originate?&#34;%7Boriginate_timeout%3D30%2Corigination_uuid%3DMYUUID%2Corigination_caller_id_name%3D123%2Corigination_caller_id_number%3D123%7Dsofia%2Fcelulares%2F3001234567%20event2dial%20XML%20event2dial%29&#34;&#39;</span>
</span></span></code></pre></div><p>aclaraciónes:</p><ul><li>se debe codificar por partes los argumentos del comando se separan con <code>%20</code> y cada argumento se codifica con url, ejemplo de codificacion en ruby seria:<ul><li><code>['{originate_timeout=30}sofia/gateway/celulares/3001234576', 'event2dial', 'XML', 'event2dial'].map { |v| URI.encode_www_form_component(v) }.join('%20')</code></li></ul></li><li><code>originate_timeout</code> = 30, esperamos almenos 30 segundos que contesten o colgamos (este comportamiento no aplica para destinos con buzón de voz).</li><li><code>origination_uuid</code> = UUIDv4, asignamos identificador a la llamada.</li><li><code>origination_caller_id_name</code> = 123, dependiendo de la linea destino podemos enviar un nombre a ser visualizado en el telefono.</li><li><code>origination_caller_id_number</code> = 123, dependiendo de la linea destino podemos enviar el numero de origen.</li></ul><p>estados de retorno:</p><p><code>+OK &lt;uuidv4></code> indicando que fue exitoso el lanzamiento de la llamada</p><p><code>-ERR &lt;cause></code> indica el motivo por el cual no se puedo lanzar la llamada</p><p>Resumiendo:</p><ul><li>requerimos un FreeSWITCH previamente configurado con una o varias pasarelas a que nos den salida a los destinos requeridos</li><li>activar y configurar <strong>mod_xml_rpc</strong></li><li>comandar llamada con <strong>originate</strong> por medio de HTTP.</li></ul><p>Con lo anterior tenemos todas las herramientas para integrar FreeSWITCH en los flujos de negoció.</p></article><div class=paginator><a class=link href=http://bit4bit.github.io/post/kamailio_sbc_msteams/>← prev</a>
<a class=link target=history href="https://chiselapp.com/user/bit4bit/repository/bit4bit_website/finfo?name=content/post%2ffreeswitch_integration_event2dial.md">history</a>
<a class=link href="https://chiselapp.com/user/bit4bit/repository/bit4bit_website/raw?ci=tip&filename=content/post%2ffreeswitch_integration_event2dial.md">source</a>
<a class=link href=http://bit4bit.github.io/post/emacs_basics_1/>next →</a></div><div class=comment></div></main><footer id=footer><div><span>© 2019</span> - <span>2023</span></div><div><span>Powered by</span>
<a class=link href=https://gohugo.io/>Hugo</a>
<span>🍦 Theme</span>
<a class=link href=https://github.com/queensferryme/hugo-theme-texify>TeXify</a></div><div class=footnote><span>Follow me on <a class=link href=https://github.com/bit4bit>GitHub</a> or
<a class=link href=http://chiselapp.com/user/bit4bit/>Chiselapp</a> or
<a class=link href=/index.xml>RSS</a> |
<a class=link href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank rel=noopener>CC BY-NC-SA 4.0</a><pre>fossil open https://chiselapp.com/user/bit4bit/repository/bit4bit_website --workdir website</pre></span></div></footer></div></body></html>